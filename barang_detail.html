<!DOCTYPE html>
<html lang="id"><head><meta charset="utf-8"><meta name="viewport"content="width=device-width,initial-scale=1"><title>Detail Barang</title>
<style>body{margin:0;font-family:Inter,Roboto;background:#fff} .header{background:linear-gradient(135deg,#3E8BFF,#A259FF);color:#fff;padding:16px;display:flex;align-items:center;gap:12px} .container{padding:18px} .top-img{width:220px;height:220px;object-fit:cover;border-radius:12px;background:#eee} .top-name{font-weight:800;font-size:20px} .top-stock{font-weight:800;color:#0066ff;font-size:26px} .card{background:#fff;padding:16px;border-radius:12px;border:1px solid #eee;margin-top:12px} .row{display:flex;justify-content:space-between;padding:8px 0} .footer{position:fixed;bottom:0;left:0;right:0;padding:12px;display:flex;gap:12px;background:#fff;border-top:1px solid #eee} .btn{flex:1;padding:12px;border-radius:12px;text-align:center;font-weight:700} .btn-outline{border:2px solid #3E8BFF;color:#3E8BFF;background:#fff}.btn-danger{background:#ff3b30;color:#fff}</style>
</head><body>
<div class="header"><img src="assets/back_white.png" id="btnBack" style="width:22px;height:22px;cursor:pointer">Detail Barang</div>
<div class="container" id="content">Memuat...</div>
<div class="footer">
  <div class="btn btn-outline" id="btnEdit">Ubah</div>
  <div class="btn btn-danger" id="btnDelete">Hapus</div>
</div>

<script src="app.js"></script>
<script>
function getID(){ const p=new URLSearchParams(window.location.search); return Number(p.get("id")); }
const content = document.getElementById("content");
document.getElementById("btnBack").onclick = ()=> guardedNavigate("barang.html");

async function loadDetail(){
  const id = getID();
  const res = await getBarangById(id);
  if(!res){ content.innerHTML = `<div style="text-align:center;padding:40px;color:#888">Barang tidak ditemukan</div>`; return; }
  const role = localStorage.getItem("role") || "staff";
  const hargaModal = role === "admin" ? `Rp ${Number(res.harga||0).toLocaleString('id-ID')}` : "-";
  content.innerHTML = `<div style="display:flex;gap:16px;align-items:center"><img src="${res.foto||'assets/no_image.png'}" class="top-img"><div style="flex:1"><div class="top-name">${res.nama}</div><div style="height:8px"></div><div class="top-stock">${res.stock||0}</div></div></div>
  <div class="card">
  <div class="row"><div>Kode Barang</div><div style="font-weight:700">${res.kode_barang}</div></div>
  <div class="row"><div>Kategori</div><div style="font-weight:700">${res.kategori||'-'}</div></div>
  <div class="row"><div>Harga Modal</div><div style="font-weight:700">${hargaModal}</div></div>
  <div class="row"><div>Harga Jual</div><div style="font-weight:700">Rp ${Number(res.harga||0).toLocaleString('id-ID')}</div></div>
  <div style="margin-top:12px">${res.deskripsi?res.deskripsi:'<i>Tidak ada deskripsi</i>'}</div>
  </div>`;
}
loadDetail();

document.getElementById("btnEdit").onclick = ()=> { const id=getID(); guardedNavigate(`edit_barang.html?id=${id}`); };

document.getElementById("btnDelete").onclick = async ()=>{
  if(!confirm("Hapus barang ini? Tindakan tidak dapat dibatalkan.")) return;
  const id = getID();
  const res = await deleteBarangAPI(id);
  if(res && res.ok){ showToast("Barang dihapus"); setTimeout(()=> guardedNavigate("barang.html"),400); } else { alert("Gagal hapus"); }
};
</script>
</body></html>
